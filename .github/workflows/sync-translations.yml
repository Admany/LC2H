name: Sync Translations

on:
  push:
    branches:
      - main
      - crowdin/translations
    paths:
      - 'src/main/resources/assets/lc2h/lang/en_us.json'
      - 'src/main/resources/assets/lc2h/lang/*.json'

jobs:
  sync-to-crowdin-branch:
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Update Crowdin branch with source changes
        run: |
          git checkout crowdin/translations
          git merge main --no-edit --allow-unrelated-histories
          git push origin crowdin/translations

  merge-translations-to-main:
    if: github.ref == 'refs/heads/crowdin/translations'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Merge translations to main
        run: |
          git checkout main
          git checkout crowdin/translations -- src/main/resources/assets/lc2h/lang
          git add src/main/resources/assets/lc2h/lang
          git commit -m "Update translations from Crowdin" || echo "No changes to commit"
          git push origin main